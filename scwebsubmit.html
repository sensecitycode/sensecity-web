
	<div  ng-controller="scWebSubmit" >
		<form class="form-horizontal" name="form" role="form" ng-submit="submitNewIssue()" id="addIssueForm">	
		<div class="col-md-8"> 
			<div style="height: 800px">
			<leaflet  lf-center="patras" layers="layers" 
				 height="100%"  style="color:black"  ></leaflet>
			</div>
			<div  after-render="invalidateTheMap"></div>
		</div>
		
		<div class="col-md-4"> 
			<div class="form-group">
				<label for="lng" style="color: #000000; font-weight: 300;" id="msg_label_long">{{'LONGTITUDE' | translate}}</label>
				<input ng-model="latlabeltxt" type="text" class="form-control" id="lng" placeholder="{{'LONGTITUDE' | translate}}" readonly >
			</div>
			<div class="form-group">
				<label for="lat" style="color: #000000; font-weight: 300;" id="msg_label_lat">{{'LATTITUDE' | translate}}</label>
				<input ng-model="lnglabeltxt" type="text" class="form-control" id="lat" placeholder="{{'LATTITUDE' | translate}}" readonly >
			</div>
			<div class="form-group">
				<label for="type-issue" style="color: #000000; font-weight: 300;" id="msg_label_type">{{ 'PROBLEMTYPE' | translate}}</label>
				<select ng-options="item as item.name | translate for item in availableIssues track by item.id" ng-model="issueTypeSelect" class="form-control" ng-change="updateCompoType()"></select>
				
			</div>
			<div class="form-group">
				<label for="exampleInputEmail1" style="color: #000000; font-weight: 300;" id="msg_problem_detail">{{ 'PROBLEM' | translate}}</label>
				
				<select ng-options="item as item.name | translate for item in issueTypeSelect.types track by item.id" ng-model="issueSubTypeSelect" class="form-control" ng-change="issueSubTypeSelectChanged()"></select>
			
			</div>
			<div class="form-group"  ng-show='isOtherSelected()'>
				<label for="other_description" style="color: #000000; font-weight: 300;" >{{ 'DESCRIPTION' | translate}}</label>
				<input ng-model="otherDescriptionTxt" type="text" class="form-control" value="" placeholder="{{ 'OTHERPROBWRITE' | translate }}"   >
			</div>
			
			<div class="form-group">
				<label for="input_file" style="color: #000000; font-weight: 300;" id="msg_photograph">{{ 'PHOTO' | translate}}</label>
				<input type="file" id="input_file"   class="form-control" file-model="uploadedPhotoFile" placeholder=""   />
				
			</div>			
			
			
			<input id="btnsubmit" class="btn btn-default" type="submit" value="{{ 'SUBMIT' | translate}}" />

			<div id="try_another_issue"></div>
		</div>
		
		
   </form>
    </div>
    

	<script>
		
		var img_base64 = 'no-image';
		
	
		
		
		$('#input_file').on("change", function(){ 

			var filesSelected = document.getElementById("input_file").files;//$("#input_file").val();
						if (filesSelected.length > 0)
						{
							var fileToLoad = filesSelected[0];
					 
							var fileReader = new FileReader();
					 
							fileReader.onload = function(fileLoadedEvent) 
							{
								img_base64 = fileLoadedEvent.target.result;
								//console.log(img_base64);
								//textAreaFileContents.innerHTML = fileLoadedEvent.target.result;
								
							};
					 
							fileReader.readAsDataURL(fileToLoad);
							//console.log(fileToLoad);
						}


			});
	
	
		
				
			

				$("#btnsubmit").click(function() {
					$("#btnsubmit").html('<i class="fa fa-refresh fa-spin fa-2x fa-fw"></i>');
					$('#btnsubmit').addClass('disabled');
					var other_='';
					
					if($("#other_description").val() !=''){
						other_ = $("#other_description").val();
					}else{
						other_ = $("#issue").val();
					}
					
					console.log(img_base64);
					
					console.log('{"loc" : { "type" : "Point",  "coordinates" : ['+$("#lng").val()+','+$("#lat").val()+'] }, "issue" : "'+$("#type-issue").val()+'","device_id" : "webapp", "value_desc" : "' + other_ + '","image_name" : "'+img_base64+'" }');
					
					$.ajax({
						crossDomain: true,
						type:"POST",
						url: "http://api.sense.city:3000/api/issue",
						data: '{"loc" : { "type" : "Point",  "coordinates" : ['+$("#lng").val()+','+$("#lat").val()+'] }, "issue" : "'+$("#type-issue").val()+'","device_id" : "webapp", "value_desc" : "' + other_ + '","image_name" : "'+img_base64+'" }',
						contentType: "application/json; charset=utf-8",
						dataType: "json",                
						success: function(msg){
							//$('#btnsubmit').removeClass('disabled');
							$("#btnsubmit").html('Αποστολή');
							$("#try_another_issue").html('<a href="submit_issue.html" class="btn btn-primary" style="background-color: #76a0ff !important;">Νέα καταχώριση</a>');
						}
					});					
					
					/*var image = document.getElementById('input_file').src;
                    image.src = "data:image/jpeg;base64," + image;
					console.log(image.src);*/
				});
				
			

		
			</script>
			
		
